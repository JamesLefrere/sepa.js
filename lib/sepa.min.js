!function(a){function e(a){d=a}function g(a){f=!!a}function i(a){var b=0===a.indexOf("pain.008")?1:0;return parseInt(a.substr(-2),10)+b}function j(a){this._painFormat=a||"pain.008.001.02",this._type=h[a],this._paymentInfo=[],this.grpHdr=new k(this._painFormat)}function k(a){this._painFormat=a}function m(a){this._painFormat=a,this.method=0===a.indexOf("pain.001")?l.Transfer:l.DirectDebit,this._payments=[]}function o(a){this._painFormat=a,this._type=0===a.indexOf("pain.001")?n.Transfer:n.DirectDebit}function p(a){for(var b="",c=0,d=a.length;c<d;++c){var e=a.charCodeAt(c);e>=65&&e<=90?b+=(e-55).toString():e>=97&&e<=122?b+=(e-87).toString():e>=48&&e<=57&&(b+=a[c])}return b}function q(a){for(var b=0,c=0,d=a.length;c<d;++c)b=(10*b+parseInt(a[c],10))%97;return b}function r(a){var b=a.substr(4)+a.substr(0,4);return 1===q(p(b))}function s(a){var b=a.substr(4)+a.substr(0,2)+"00",c=q(p(b));return a.substr(0,2)+("0"+(98-c)).substr(-2,2)+a.substr(4)}function t(a){var b=a.substr(7)+a.substr(0,4);return 1===q(p(b))}function u(a){var b=a.substr(7)+a.substr(0,2)+"00",c=q(p(b));return a.substr(0,2)+("0"+(98-c)).substr(-2,2)+a.substr(4)}function v(a,b){if(!a)throw new Error(b)}function w(a,b,c){if(b.indexOf(a)<0)throw new Error(c+" must have any value of: "+b.join(" ")+"(found: "+a+")")}function x(a,b,c,d){if(null!==b&&a&&a.length<b||null!==c&&a&&a.length>c)throw new Error(d+" has invalid string length, expected "+b+" < "+a+" < "+c)}function y(a,b,c,d){if(a<b||a>c)throw new Error(d+" does not match range "+b+" < "+a+" < "+c)}function z(a,b){if(!r(a))throw new Error(b+' has invalid IBAN "'+a+'"')}function A(a,b){if(!t(a))throw new Error(b+' is invalid "'+a+'"')}function B(a,b){if(!a||isNaN(a.getTime()))throw new Error(b+" has invalid date "+a)}function C(a,b){if(a&&!a.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|'| ]){1,35}/))throw new Error(b+" doesn't match sepa id charset type 1 (found: \""+a+'")')}function D(a,b){if(a&&!a.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|']){1,35}/))throw new Error(b+" doesn't match sepa id charset type 2 (found: \""+a+'")')}function E(a,b){if("undefined"!=typeof document&&"undefined"!=typeof document.implementation)return document.implementation.createDocument(a,b);var c=require("xmldom").DOMImplementation;return(new c).createDocument(a,b)}function F(a){var b;if("undefined"==typeof window){var c=require("xmldom").XMLSerializer;b=new c}else b=new window.XMLSerializer;return b.serializeToString(a)}function G(a,b,c){return function(){var d=arguments[0],e=c&&arguments[arguments.length-1],f=c?arguments.length-1:arguments.length;if(b||e||0===e){for(var g=1;g<f;++g)d=d.appendChild(a.createElementNS(a.documentElement.namespaceURI,arguments[g]));return c&&(d.textContent=e),d}return null}}var b="http://www.w3.org/2001/XMLSchema-instance",c="urn:iso:std:iso:20022:tech:xsd:",d=".",f=!0,h={"pain.001.001.02":"pain.001.001.02","pain.001.003.02":"pain.001.003.02","pain.001.001.03":"CstmrCdtTrfInitn","pain.001.003.03":"CstmrCdtTrfInitn","pain.008.001.01":"pain.008.001.01","pain.008.003.01":"pain.008.003.01","pain.008.001.02":"CstmrDrctDbtInitn","pain.008.003.02":"CstmrDrctDbtInitn"};j.Types=h,j.prototype={_painFormat:null,grpHdr:null,_paymentInfo:[],_type:null,addPaymentInfo:function(a){if(!(a instanceof m))throw new Error("Given payment is not member of the PaymentInfo class");a.id?a.id=this.grpHdr.id+d+a.id:a.id=this.grpHdr.id+d+this._paymentInfo.length,this._paymentInfo.push(a)},createPaymentInfo:function(){return new m(this._painFormat)},normalize:function(){for(var a=0,b=0,c=0,d=this._paymentInfo.length;c<d;++c)this._paymentInfo[c].normalize(),a+=this._paymentInfo[c].controlSum,b+=this._paymentInfo[c].transactionCount;this.grpHdr.controlSum=a,this.grpHdr.transactionCount=b},toXML:function(){this.normalize();var a="urn:iso:std:iso:20022:tech:xsd:"+this._painFormat,d=E(a,"Document"),e=d.documentElement;e.setAttributeNS(b,"xsi:schemaLocation",c+this._painFormat+" "+this._painFormat+".xsd");var f=d.createElementNS(a,this._type);f.appendChild(this.grpHdr.toXML(d));for(var g=0,h=this._paymentInfo.length;g<h;++g)f.appendChild(this._paymentInfo[g].toXML(d));return d.documentElement.appendChild(f),d},toString:function(){return F(this.toXML())}},k.prototype={_painFormat:null,id:"",created:"",transactionCount:0,initiatorName:"",controlSum:0,batchBooking:!1,grouping:"MIXD",toXML:function(a){var b=G(a,!0,!0),c=a.createElementNS(a.documentElement.namespaceURI,"GrpHdr"),d=i(this._painFormat);return b(c,"MsgId",this.id),b(c,"CreDtTm",this.created.toISOString()),2===d&&b(c,"BtchBookg",this.batchBooking.toString()),b(c,"NbOfTxs",this.transactionCount),b(c,"CtrlSum",this.controlSum.toFixed(2)),2===d&&b(c,"Grpg",this.grouping),b(c,"InitgPty","Nm",this.initiatorName),c},toString:function(){return F(this.toXML())}};var l={DirectDebit:"DD",Transfer:"TRF"};m.PaymentInfoTypes=l,m.prototype={_painFormat:null,_payments:null,id:"",method:null,batchBooking:!1,grouping:"MIXD",controlSum:0,localInstrumentation:null,sequenceType:"FRST",collectionDate:null,requestedExecutionDate:null,creditorId:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",debtorId:"",debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",instructionPriority:"NORM",get transactionCount(){return this._payments.length},normalize:function(){for(var a=0,b=0,c=this._payments.length;b<c;++b)a+=this._payments[b].amount;this.controlSum=a},addTransaction:function(a){if(!(a instanceof o))throw new Error("Given Transaction is not member of the SepaTransaction class");a.id?a.id=this.id+d+a.id:a.id=this.id+d+this._payments.length,this._payments.push(a)},createTransaction:function(){return new o(this._painFormat)},validate:function(){var a=this.method===l.DirectDebit?"creditor":"debtor";this.localInstrumentation&&w(this.localInstrumentation,["CORE","COR1","B2B"],"localInstrumentation"),w(this.sequenceType,["FRST","RCUR","OOFF","FNAL"],"sequenceType"),this.method===l.DirectDebit?B(this.collectionDate,"collectionDate"):B(this.requestedExecutionDate,"requestedExecutionDate"),A(this[a+"Id"],a+"Id"),x(this[a+"Name"],null,70,a+"Name"),x(this[a+"Street"],null,70,a+"Street"),x(this[a+"City"],null,70,a+"City"),x(this[a+"Country"],null,2,a+"Country"),z(this[a+"IBAN"],a+"IBAN"),x(this[a+"BIC"],[0,8,11],a+"BIC");var b=0===this[a+"BIC"].length||this[a+"BIC"].substr(4,2)===this[a+"IBAN"].substr(0,2);v(b,"country mismatch in BIC/IBAN"),x(this._payments.length,1,null,"_payments")},toXML:function(a){f&&this.validate();var b=G(a,!0,!1),c=G(a,!0,!0),d=a.createElementNS(a.documentElement.namespaceURI,"PmtInf");c(d,"PmtInfId",this.id),c(d,"PmtMtd",this.method),3===i(this._painFormat)&&(c(d,"BtchBookg",this.batchBooking.toString()),c(d,"NbOfTxs",this.transactionCount),c(d,"CtrlSum",this.controlSum.toFixed(2)));var e=b(d,"PmtTpInf");c(e,"SvcLvl","Cd","SEPA"),this.localInstrumentation&&c(e,"LclInstrm","Cd",this.localInstrumentation),this.method===l.DirectDebit?(c(e,"SeqTp",this.sequenceType),c(d,"ReqdColltnDt",this.collectionDate.toISOString().substr(0,10))):c(d,"ReqdExctnDt",this.requestedExecutionDate.toISOString().substr(0,10));var g=this.method===l.DirectDebit?"creditor":"debtor",h=this.method===l.DirectDebit?"Cdtr":"Dbtr",j=b(d,h);if(c(j,"Nm",this[g+"Name"]),this[g+"Street"]&&this[g+"City"]&&this[g+"Country"]){var k=b(j,"PstlAdr");c(k,"Ctry",this[g+"Country"]),c(k,"AdrLine",this[g+"Street"]),c(k,"AdrLine",this[g+"City"])}if(c(d,h+"Acct","Id","IBAN",this[g+"IBAN"]),this[g+"BIC"]?c(d,h+"Agt","FinInstnId","BIC",this[g+"BIC"]):c(d,h+"Agnt","FinInstnId","Othr","Id","NOTPROVIDED"),c(d,"ChrgBr","SLEV"),this.method===l.DirectDebit){var m=b(d,"CdtrSchmeId","Id","PrvtId","Othr");c(m,"Id",this.creditorId),c(m,"SchmeNm","Prtry","SEPA")}for(var n=0,o=this._payments.length;n<o;++n)d.appendChild(this._payments[n].toXML(a));return d},toString:function(){return F(this.toXML())}};var n={DirectDebit:"DrctDbtTxInf",Transfer:"CdtTrfTxInf"};o.TransactionTypes=n,o.prototype={_type:n.DirectDebit,id:"",end2endId:"",currency:"EUR",amount:0,purposeCode:null,mandateId:"",mandateSignatureDate:null,debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",remittanceInfo:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",validate:function(){var a=this._type===n.Transfer?"creditor":"debtor";C(this.end2endId,"end2endId"),y(this.amount,.01,999999999.99,"amount"),v(this.amount==this.amount.toFixed(2),"amount has too many fractional digits"),x(this.purposeCode,1,4,"purposeCode"),D(this.mandateId,"mandateId"),B(this.mandateSignatureDate,"mandateSignatureDate"),x(this[a+"Name"],null,70,a+"Name"),x(this[a+"Street"],null,70,a+"Street"),x(this[a+"City"],null,70,a+"City"),x(this[a+"Country"],null,2,a+"Country"),z(this[a+"IBAN"],a+"IBAN"),w(this[a+"BIC"].length,[0,8,11],a+"BIC");var b=0===this[a+"BIC"].length||this[a+"BIC"].substr(4,2)===this[a+"IBAN"].substr(0,2);v(b,"country mismatch in BIC/IBAN"),x(this.remittanceInfo,null,140,"remittanceInfo")},toXML:function(a){f&&this.validate();var b=this._type===n.Transfer?"creditor":"debtor",c=this._type===n.Transfer?"Cdtr":"Dbtr",d=G(a,!0,!1),e=G(a,!1,!0),g=G(a,!0,!0),h=a.createElementNS(a.documentElement.namespaceURI,this._type),i=d(h,"PmtId");if(g(i,"InstrId",this.id),g(i,"EndToEndId",this.end2endId),this._type===n.DirectDebit){g(h,"InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);var j=d(h,"DrctDbtTx","MndtRltdInf");g(j,"MndtId",this.mandateId),g(j,"DtOfSgntr",this.mandateSignatureDate.toISOString().substr(0,10)),this.ammendment?(g(j,"AmdmntInd","true"),g(j,"AmdmnInfDtls",this.ammendment)):g(j,"AmdmntInd","false")}else g(h,"Amt","InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);this[b+"BIC"]?g(h,c+"Agt","FinInstnId","BIC",this[b+"BIC"]):g(h,c+"Agt","FinInstnId","Othr","Id","NOTPROVIDED");var k=d(h,c);if(g(k,"Nm",this[b+"Name"]),this[b+"Street"]&&this[b+"City"]&&this[b+"Country"]){var l=d(k,"PstlAdr");g(l,"Ctry",this.debtorCountry),g(l,"AdrLine",this.debtorStreet),g(l,"AdrLine",this.debtorCity)}return g(h,c+"Acct","Id","IBAN",this[b+"IBAN"]),g(h,"RmtInf","Ustrd",this.remittanceInfo),e(h,"Purp","Cd",this.purposeCode),h}},a.Document=j,a.validateIBAN=r,a.checksumIBAN=s,a.validateCreditorID=t,a.checksumCreditorID=u,a.setIDSeparator=e,a.enableValidations=g}("undefined"==typeof exports?this.SEPA={}:exports);